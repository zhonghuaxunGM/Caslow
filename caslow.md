# 数据库自管理工具 （Caslow雷斯提克）的设计以及实现


## 为什么要做数据库自管理？

        在快速迭代的过程中，数据库变更频繁，且作为数据层的重要组件需要大量的人力进行一个记录以及维护的工作。为了简化程序猿的工作，故数据库自管理的诞生势在必行。

## Caslow是什么？

        Caslow是一个自主研发的数据库自管理工具，被要求满足于当前研发的需要，减轻工程师工作负担，担任一个记录以及维护数据库变更以及操作的内部研发工具。
    
        Caslow是一个数据库自管理服务，不仅可以在开发或测试环境上运行，还需要部署到演示环境和正式环境。Caslow对产品业务不会产生负面影响，需要额外添加部署升级的工作。
    
        Caslow收到研发工程师的数据库操作提交，其会执行操作并且记录操作。不再需要工程师手动修改数据库以及对数据库操作记录的备案。Caslow简化了内部工作流程，减少了沟通时间和交接产生的问题。

## Caslow可以支持什么？

### 1. 两种数据操作
        a. 支持工程师上传数据库修改（Alter/Update）脚本或新增（Create/Insert）脚本，读取上传的数据库脚本文件（.sql）对指定数据库进行一个执行脚本的操作。

        b. 支持工程师直接输入执行SQL语句（Insert/Update/Delete），对指定数据库进行一个执行的操作。

### 2. SQL合法性校验
        支持以上两种方式的操作的检验SQL合法性以及用户操作权限的功能。
    
### 3. SQL记录备案
        支持以上两种方式的操作记录以及执行SQL语句的备案。在进行数据库版本管理时，便于统计。
  
### 4. 版本标签功能
        支持对当前时间节点的数据库记录进行打tag的操作。将上一次tag之后的所有脚本文件内容以及执行内容，作为新tag升级脚本文件存下，成为部署版本升级的SQL脚本文件。

### 5. 审批机制
        支持修改数据和打tag标签的审批功能。修改数据库以及打tag都需要组长进行验证语句的可行性，以及打tag项目进度的合理性。

### 6. 数据库升级功能
        a. 支持执行数据库自升级管理，取消原本人为的执行数据库脚本文件来升级，由自管理工具统一执行操作。

        b. 支持数据库备份处理和支持数据库回滚处理

        c. 数据库版本控制会根据一张表内的数据库版本字段来判定，数据库当前需要执行何种升级的操作。每一次执行升级脚本，都会对该数据库的版本进行更新，以免重复升级。

## Caslow如何使用？

1. 有关上传脚本或执行数据库修改内容

2. 有关预处理数据库修改内容以及确认

3. 有关审批机制的通过与驳回

4. 有关数据库的自动升级

